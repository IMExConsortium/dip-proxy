<?xml version="1.0" encoding="UTF-8"?>

<!-- ===========================================================================
 ! $HeadURL::                                                                  $
 ! $Id::                                                                       $
 ! Version: $Rev::                                                             $
 !==============================================================================
 !
 ! dip-proxy: application context
 !
 !========================================================================== -->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"

    xmlns:ws="http://jax-ws.dev.java.net/spring/core"
    xmlns:wss="http://jax-ws.dev.java.net/spring/servlet"

    xsi:schemaLocation="
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx 
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop 
        http://www.springframework.org/schema/aop/spring-aop.xsd

        http://jax-ws.dev.java.net/spring/core
        http://jax-ws.dev.java.net/spring/core.xsd
        http://jax-ws.dev.java.net/spring/servlet
        http://jax-ws.dev.java.net/spring/servlet.xsd">

 <!-- ============================================================== CONTEXT -->

 <import resource="spring/contextBean.xml" />

 <!-- ======================================================= REMOTE SERVERS -->

 <import resource="spring/serversBean.xml" />

 <!-- ============================================================ SCHEDULER -->

 <import resource="spring/schedulerBean.xml" /> 

 <!-- ============================================================ AOP AUDIT -->

 <import resource="spring/auditBean.xml" /> 

 <!-- ================================================================== DAO -->

 <import resource="spring/daoBean.xml"/>

 <!--==========================================================  TRANSFORMER -->

 <bean id="proxyTransformer" init-method="initialize" 
       class="edu.ucla.mbi.proxy.ProxyTransformer">
  <property name="transformerContext" ref="transformerContext"/>
  <property name="contextTop" value="transformer"/>
 </bean>

 <!-- ======================================================= STRUTS ACTIONS -->

 <import resource="spring/struts-actions.xml" /> 

 <!-- ======================================================= PROXY SERVICES -->

 <bean id="wsContext" init-method="initialize" destroy-method="cleanup"
       class="edu.ucla.mbi.server.WSContext">

  <property name="dipProxyDAO" ref="dipProxyDAO" />   

  <property name="dht" ref="dht" />
  <property name="transformer" ref="proxyTransformer" />
  <property name="mcClient" ref="mcClient" />

  <property name="services">
   <map>
     <entry key="EBI">  
      <map>
       <entry key="timeout" value="600"/> <!-- NOTE: default unit seconds -->
       <entry key="ttl" value="17"/>  <!-- NOTE: default unit days --> 
       <entry key="maxRetry" value="3"/>

       <entry key="nativeServer"> 
            <ref bean="ebiReferenceServer"/>
       </entry>      
      
       <entry key="proxyProto"> 
        <ref bean="referenceProxy"/>
       </entry>      
    

       <entry key="router">
        <ref bean="ebiDhtRouter"/> 
        <!-- <ref bean="ebiSimpleRouter"/>  -->
       </entry>
        
       <entry key="ramCache" value="off"/>
       <entry key="dbCache" value="on"/>
       <entry key="remoteProxy" value="on"/>
       <entry key="monitor" value="off"/>
       <entry key="debug" value="0"/>

       <entry key="serviceSet">
         <set>
           <value>uniprot</value>
           <value>picr</value>
           <value>olsmeta</value>
           <value>olsname</value>
         </set>
       </entry>
      </map>
     </entry>

     <entry key="NCBI"> 
      <map> 
       <entry key="timeout" value="600"/>
       <entry key="ttl" value="30"/>
       <entry key="maxRetry" value="3"/>

       <entry key="nativeServer">
        <ref bean="ncbiReferenceServer"/>
       </entry>      
              
       <entry key="proxyProto"> 
        <ref bean="referenceProxy"/>
       </entry>      

       <entry key="router">
        <ref bean="ncbiDhtRouter"/> 
       </entry>
       
       <entry key="ramCache" value="off"/>
       <entry key="dbCache" value="on"/>
       <entry key="remoteProxy" value="off"/>
       <entry key="monitor" value="off"/>
       <entry key="debug" value="0"/> 

       <entry key="serviceSet">
         <set>
           <value>pubmed</value>
           <value>refseq</value>
           <value>nlm</value>
           <value>entrezgene</value>
           <value>taxon</value>
         </set>
       </entry>

      </map>
     </entry>

     <entry key="MBI"> 
      <map>
       <entry key="timeout" value="600"/>
       <entry key="ttl"     value="14"/>
       <entry key="maxRetry" value="3"/> 

       <entry key="nativeServer">  
        <ref bean="prlReferenceServer"/>
       </entry>      

       <entry key="ncbiProxyAddress">
         <!--<value>http://dip.doe-mbi.ucla.edu/dip-proxy/ncbi-service</value> -->
         <value> http://10.1.200.201:8080/dip-proxy-server/proxy-service</value>
       </entry>

       <entry key="proxyProto"> 
        <ref bean="referenceProxy"/>
       </entry>      
       
       <entry key="router">
        <ref bean="mbiDhtRouter"/> 
       </entry>

       <entry key="ramCache" value="off"/>
       <entry key="dbCache" value="off"/>
       <entry key="remoteProxy" value="off"/>
       <entry key="monitor" value="off"/>
       <entry key="debug" value="0"/>

       <entry key="serviceSet">
         <set>
           <value>prolinks</value>
         </set>
       </entry>

      </map>
     </entry>

     <entry key="DIP"> 
      <map>
       <entry key="timeout" value="600"/>
       <entry key="ttl" value="14"/>
       <entry key="maxRetry" value="3"/>

       <entry key="nativeServer"> 
        <ref bean="dipReferenceServer"/>
       </entry>      

       <entry key="proxyProto">
        <ref bean="referenceProxy"/>
       </entry>
       
       <entry key="router">
        <ref bean="dipDhtRouter"/> 
       </entry>

       <entry key="ramCache" value="off"/>
       <entry key="dbCache" value="off"/>
       <entry key="remoteProxy" value="off"/>
       <entry key="monitor" value="off"/>
       <entry key="debug" value="0"/>
  
       <entry key="serviceSet">
         <set>
           <value>dip</value>
           <value>diplegacy</value>
         </set>
       </entry>

      </map>
     </entry>

     <entry key="SGD">
      <map>
       <entry key="timeout" value="600"/>
       <entry key="ttl" value="14"/>
       <entry key="maxRetry" value="3"/>

       <entry key="nativeServer">
         <ref bean="nativeRestServer"/>
       </entry>

       <entry key="proxyProto">
        <ref bean="referenceProxy"/>
       </entry>

       <entry key="router">
         <ref bean="yeastMineDhtRouter"/> 
       </entry>

       <entry key="ramCache" value="off"/>
       <entry key="dbCache" value="off"/>
       <entry key="remoteProxy" value="off"/>
       <entry key="monitor" value="off"/>
       <entry key="debug" value="0"/>

       <entry key="serviceSet">
         <set>
           <value>yeastmine</value>
         </set>
       </entry>

      </map>
     </entry>
   </map> 
  </property>

 </bean>

 <!-- ============================================================ MEMCACHED -->

 <bean id="mcClient" class="edu.ucla.mbi.util.cache.McClient">
  <property name="mcf">
    <ref bean="memcachedClient"/>
  </property>
  <property name="ttl" value="864000" />
  <property name="prefix" value="PROXY"/>
 </bean>

 <bean id="memcachedClient"
          class="net.spy.memcached.spring.MemcachedClientFactoryBean">
  <property name="servers" value="10.1.4.111:11211"/>
  <property name="protocol" value="BINARY"/>
  <property name="transcoder">
    <bean class="net.spy.memcached.transcoders.SerializingTranscoder">
        <property name="compressionThreshold" value="1024"/>
    </bean>
  </property>
  <property name="opTimeout" value="1000"/>
  <property name="timeoutExceptionThreshold" value="1998"/>
  <property name="hashAlg">
    <value type="net.spy.memcached.DefaultHashAlgorithm">KETAMA_HASH</value>
  </property>
  <property name="locatorType" value="CONSISTENT"/>
  <property name="failureMode" value="Redistribute"/>
  <property name="useNagleAlgorithm" value="false"/>
 </bean>

 <!-- ========================================================= WEB SERVICES -->

 <bean id="proxy-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.ProxyPortImpl" >
   <property name="wsContext" ref="wsContext"/> 
 </bean>

 <bean id="ncbi-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.ncbi.NcbiCachingImpl" >
   <property name="wsContext" ref="wsContext"/>
 </bean>

 <bean id="ebi-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.ebi.EbiCachingImpl" >
   <property name="wsContext" ref="wsContext"/>
 </bean>

 <bean id="dht-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.dht.DhtProxyImpl" >
   <property name="wsContext" ref="wsContext"/> 
 </bean>

 <bean id="dip-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.dip.DipCachingImpl" >
   <property name="wsContext" ref="wsContext"/>
 </bean>

 <bean id="prolinks-service-bean" init-method="initialize"
       class="edu.ucla.mbi.proxy.prolinks.ProlinksCachingImpl" >
   <property name="wsContext" ref="wsContext"/>
 </bean>

 <ws:service  id="proxy-service-id" bean="#proxy-service-bean"/>
 <wss:binding url="/proxy-service" service="#proxy-service-id" />

 <ws:service  id="dht-service-id" bean="#dht-service-bean"/>
 <wss:binding url="/dht-service" service="#dht-service-id" />

 <ws:service  id="ncbi-service-id" bean="#ncbi-service-bean"/>
 <wss:binding url="/ncbi-service" service="#ncbi-service-id" />

 <ws:service  id="ebi-service-id" bean="#ebi-service-bean"/>
 <wss:binding url="/ebi-service" service="#ebi-service-id" />

 <ws:service  id="dip-service-id" bean="#dip-service-bean"/>
 <wss:binding url="/dip-service" service="#dip-service-id" />

 <ws:service  id="prolinks-service-id" bean="#prolinks-service-bean"/>
 <wss:binding url="/prolinks-service" service="#prolinks-service-id" />


 <import resource="spring/cxf.xml" />

</beans>
